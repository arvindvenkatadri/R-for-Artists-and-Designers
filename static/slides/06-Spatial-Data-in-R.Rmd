---
title: "06-Spatial-Data-in-R"
subtitle: "Understanding Spatial Data and basics of Maps in R" 
author: "Arvind Venkatadri"
date: 03/July/2021
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
  code_download: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE, 
  comment = NA, dpi = 300,
  fig.align = "center", out.width = "65%", cache = FALSE)
library(tidyverse)
```

## What is a Feature?

- A Thing, or an Object in the real world, such as a building or a tree. 
- As is the case with Objects, they often consist of other objects.  
- This is the case with features too: a set of features can form a single feature. 
- Examples of Features:  
-- A forest stand  
-- a city with building, streets, and parks  
-- A satellite image pixel   
-- a complete image can be a feature too.

-  A feature geometry is called **simple**  
  - when it consists of points connected by straight line pieces,  
  - and does not intersect itself.
---

## What is a Geometry?

- Features have a geometry describing where on Earth the feature is located  
- they have attributes, which describe other properties.  
- Examples:  
-- The geometry of a tree can be the delineation of its crown,  
-- of its stem,  
-- or the point indicating its centre.   

- Other properties may include its height, color, diameter at breast height at a particular date, species and so on.


---

## What is Geospatial Data?

.pull-left[

- Geospatial vector data consist of geometries defined based on geographic coordinates. 

- Geospatial Data describes **features** 

- Features are represented by any combination of these shapes ( And there are more shapes if you want them!!)

- And shows up in a special **geometry** column in the data

- Examples:  
-- Point: buildings, offices, venues, etc in a city  
-- LineString: Roads, rivers and railways  
-- Polygon: a lake, a golf course, or the border of a country  
-- MultiPolygon: Any non-contiguous set of areas  
]

.pull-right[
![Spatial Geometries](images/sf-classes.png)
]
---

## How are these shapes represented?

.pull-left[
![Geometry Primitives](https://cengel.github.io/R-spatial/img/wkt_primitives.png)
]

.pull-right[
![Multipart Geometry Representation](https://cengel.github.io/R-spatial/img/wkt_multipart.png)

]

---

## The `sf` package and the Spatial Data Frame: Points

.pull-left[

```{r plot1a, eval=FALSE, message=FALSE,warning=FALSE}
india <- 
  ne_states(country =  "india", 
            geounit = "india", 
            returnclass = "sf")
crs_india <- st_crs(india)
points <- 
  data.frame(lon = rnorm(5, 77, 2), 
             lat = rnorm(5, 23, 5)) %>% 
  st_as_sf(., coords = c("lon", "lat"),
           crs = crs_india)
str(points)

ggplot() + #<<
    geom_sf(data = india) + #<<
    geom_sf(data = points, colour = "red", size = 4) #<<

```
]

.pull-right[
```{r first-plot1a-out, ref.label='plot1a', echo=FALSE,message=FALSE,warning=FALSE, out.width ="90%"}
```
]

---

## The `sf` package and the Spatial Data Frame: MultiPolygons

.pull-left[

```{r plot1b, eval=FALSE, message=FALSE,warning=FALSE}
outer <- matrix(c(0,0,10,0,10,10,0,10,0,0) + c(77,23), 
               ncol = 2, byrow = TRUE)
outer <- matrix(c(0,0,10,0,10,10,0,10,0,0) + c(77,23), ncol=2, byrow=TRUE)
hole1 <- matrix(c(1,1,1,2,2,2,2,1,1,1) + c(77,23),ncol=2, byrow=TRUE)
hole2 <- matrix(c(5,5,5,6,6,6,6,5,5,5) + c(77,23),ncol=2, byrow=TRUE)
pl1 <- list(outer, hole1, hole2)
pl1 <- st_polygon(pl1) %>% st_sfc() %>% st_as_sf(crs = crs_india)

ggplot() + #<<
    geom_sf(data = india) + #<<
    geom_sf(data = pl1, colour = "red") #<<
```
]

.pull-right[

```{r first-plot1b-out, ref.label='plot1b', echo=FALSE,message=FALSE,warning=FALSE, out.width ="90%"}
```

]

---
## Data Structure in `sf`
![Spatial Data Frame](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/sf.png)


---
## Getting hold of Spatial Data

Using `osmplot`
Using `rnaturalearth`


---

## Using `osmplot` to get spatial data



---

## Using `rnaturalearth` to get spatial data

---

class: center, middle

# Thanks!

Slides created by Arvind Venkatadri via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)<br>

